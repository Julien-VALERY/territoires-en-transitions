(()=>{"use strict";const t=t=>null!=t.id&&null!=t.pathname;class e{constructor({epci_id:t,indicateur_id:e,year:i,value:r}){this.epci_id=t,this.indicateur_id=e,this.year=i,this.value=r}get pathname(){return e.pathname}}e.pathname="indicateur_value";class i extends e{static buildId(t,e,i){return`${t}/${e}/${i}`}get id(){return i.buildId(this.epci_id,this.indicateur_id,this.year)}}class r{constructor({host:t,endpoint:e,serializer:i,deserializer:r}){this.host=t,this.pathname=e,this.serializer=i,this.deserializer=r}async store(e){if(!t(e))throw new Error(typeof e+" is not storable.");const i=await fetch(`${this.host}/${this.pathname}/`,{method:"POST",mode:"cors",body:JSON.stringify(this.serializer(e))});return this.deserializer(await i.json())}async retrieveAll(){return this.retrieveAtPath("all")}async retrieveById(t){return this.retrieveByPath(t)}async retrieveByPath(t){const e=await fetch(`${this.host}/${this.pathname}/${t}`,{mode:"cors",method:"GET"});return 404==e.status?null:this.deserializer(await e.json())}async retrieveAtPath(t){const e=await fetch(`${this.host}/${this.pathname}/${t}`,{mode:"cors",method:"GET"}),i=await e.json(),r=[];for(let t=0;t<i.length;t++)r.push(this.deserializer(i[t]));return r}async deleteById(t){return 200==(await fetch(`${this.host}/${this.pathname}/${t}`,{mode:"cors",method:"DELETE"})).status}}const s=()=>{const t=new URLSearchParams(window.location.search).get("epci_id");if(!t)throw new Error("Parameter epci_id is empty.");return t};class a{constructor({action_id:t,epci_id:e,avancement:i}){this.action_id=t,this.epci_id=e,this.avancement=i}get pathname(){return a.pathname}}a.pathname="action_status";class n extends a{static buildId(t,e){return`${t}/${e}`}get id(){return n.buildId(this.epci_id,this.action_id)}}class h{constructor({uid:t,epci_id:e,mesure_id:i,name:r,description:s}){this.uid=t,this.epci_id=e,this.mesure_id=i,this.name=r,this.description=s}get pathname(){return h.pathname}}h.pathname="action_custom";class c extends h{static buildId(t,e,i){return`${t}/${e}/${i}`}get id(){return c.buildId(this.epci_id,this.mesure_id,this.uid)}}const o=()=>{const t=window.location.hostname;if("localhost"===t.substring(0,10))return"http://localhost:8000";if("sandbox.territoiresentransitions.fr"===t)return"https://sandboxterritoires.osc-fr1.scalingo.io";if("staging.territoiresentransitions.fr"===t)return"https://territoiresentransitions.osc-fr1.scalingo.io";throw`no API host for ${t}`};class d{constructor({uid:t,epci_id:e,climat_pratic_thematic_id:i,name:r}){this.uid=t,this.epci_id=e,this.climat_pratic_thematic_id=i,this.name=r}get pathname(){return d.pathname}}d.pathname="mesure_custom";class l extends d{static buildId(t,e){return`${t}/${e}`}get id(){return l.buildId(this.epci_id,this.uid)}}class u{constructor({host:t,endpoint:e,serializer:i,deserializer:s}){this.cache=null,this.retrieving=null,this.host=t,this.pathname=e,this.serializer=i,this.deserializer=s,this.api=new r({host:this.host,endpoint:this.pathname,serializer:this.serializer,deserializer:this.deserializer})}async store(e){if(!t(e))throw new Error(typeof e+" is not storable.");const i=await this.api.store(e);return this.writeInCache(i)}retrieveAll(){return this.getCache()}async retrieveById(t){return this.retrieveByPath(t)}async retrieveByPath(t){const e=await this.getCache();for(let i of e)if(i.id.startsWith(t))return i;return null}async retrieveAtPath(t){const e=await this.getCache(),i=[];for(let r of e)r.id.startsWith(t)&&i.push(r);return i}async deleteById(t){const e=await this.api.deleteById(this.stripId(t)),i=await this.getCache();return this.cache=i.filter((e=>e.id!==t)),e}stripId(t){const e=this.pathname.split("/");let i=t.split("/"),r=!1;for(let t=0;t<e.length;t++)if(e[t]==i[0])r=!0,i=i.slice(1);else if(r)break;return i.join("/")}async writeInCache(t){await this.removeFromCache(t.id);const e=await this.getCache();return e.push(t),this.cache=e,t}async removeFromCache(t){const e=await this.getCache(),i=e.filter((e=>e.id!==t)),r=i.length!=e.length;return this.cache=i,r}async getCache(){return null!==this.cache?this.cache:(null===this.retrieving&&(this.retrieving=this.api.retrieveAll(),this.retrieving.then((t=>{this.cache=t}))),this.retrieving)}}const p=new u({host:o(),endpoint:`v1/${e.pathname}/${s()}`,serializer:t=>t,deserializer:t=>new i(t)}),m=new u({host:o(),endpoint:`v1/${a.pathname}/${s()}`,serializer:t=>t,deserializer:t=>new n(t)}),y=(new u({host:o(),endpoint:`v1/${h.pathname}/${s()}`,serializer:t=>t,deserializer:t=>new c(t)}),new u({host:o(),endpoint:`v1/${d.pathname}/${s()}`,serializer:t=>t,deserializer:t=>new l(t)}),s());document.querySelectorAll(".status").forEach((t=>(t=>{let e=t.dataset.actionId||"",i=t.querySelectorAll('input[type="radio"]');((t,e)=>{let i=e=>{const i=e.target.value,r=new n({epci_id:y,action_id:t,avancement:i});m.store(r)};e.forEach((t=>{t.addEventListener("change",i)}))})(e,i),(async(t,e)=>{let i="pas_faite";try{const r=await m.retrieveById(`${y}/${t}`);r&&(i=r.avancement)}catch(t){}finally{const r=`action-${t}_${i}`;e.forEach((t=>{t.id===r&&(t.checked=!0)}))}})(e,i)})(t)));const v=t=>{t.preventDefault()},f=t=>{const e=t.target,{id:r,year:a}=$(e),n=s(),h=new i({epci_id:n,indicateur_id:r,year:a,value:e.value});p.store(h)},w=t=>{"Enter"===t.key&&t.target.blur()},_=async t=>{t.value="",t.addEventListener("blur",f),t.addEventListener("keypress",w)},$=t=>({id:t.dataset.indicatorId,year:+t.dataset.indicatorYear});document.querySelectorAll('[data-component="indicatorForm"]').forEach((t=>{(async t=>{t.addEventListener("submit",v);const e=t.querySelectorAll("input");for(let t of e)_(t);const{id:i,year:r}=$(e[0]),a=s(),n=await p.retrieveAtPath(`${a}/${i}`);for(let t of e){const{id:e,year:i}=$(t);let r="";for(let t of n)t.year==i&&t.indicateur_id==e&&(r=t.value);t.value=r}})(t)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90ZXJyaXRvaXJlc2VudHJhbnNpdGlvbnMuZnIvLi9zcmMvYXBpL3N0b3JhYmxlLnRzIiwid2VicGFjazovL3RlcnJpdG9pcmVzZW50cmFuc2l0aW9ucy5mci8uL3ZlbmRvcnMvaW5kaWNhdGV1cl92YWx1ZS50cyIsIndlYnBhY2s6Ly90ZXJyaXRvaXJlc2VudHJhbnNpdGlvbnMuZnIvLi9zcmMvc3RvcmFibGVzL0luZGljYXRldXJWYWx1ZVN0b3JhYmxlLnRzIiwid2VicGFjazovL3RlcnJpdG9pcmVzZW50cmFuc2l0aW9ucy5mci8uL3NyYy9hcGkvYXBpU3RvcmUudHMiLCJ3ZWJwYWNrOi8vdGVycml0b2lyZXNlbnRyYW5zaXRpb25zLmZyLy4vc3JjL2FwaS9jdXJyZW50RXBjaS50cyIsIndlYnBhY2s6Ly90ZXJyaXRvaXJlc2VudHJhbnNpdGlvbnMuZnIvLi92ZW5kb3JzL2FjdGlvbl9zdGF0dXMudHMiLCJ3ZWJwYWNrOi8vdGVycml0b2lyZXNlbnRyYW5zaXRpb25zLmZyLy4vc3JjL3N0b3JhYmxlcy9BY3Rpb25TdGF0dXNTdG9yYWJsZS50cyIsIndlYnBhY2s6Ly90ZXJyaXRvaXJlc2VudHJhbnNpdGlvbnMuZnIvLi92ZW5kb3JzL2FjdGlvbl9jdXN0b20udHMiLCJ3ZWJwYWNrOi8vdGVycml0b2lyZXNlbnRyYW5zaXRpb25zLmZyLy4vc3JjL3N0b3JhYmxlcy9BY3Rpb25DdXN0b21TdG9yYWJsZS50cyIsIndlYnBhY2s6Ly90ZXJyaXRvaXJlc2VudHJhbnNpdGlvbnMuZnIvLi9zcmMvYXBpL2N1cnJlbnRBUEkudHMiLCJ3ZWJwYWNrOi8vdGVycml0b2lyZXNlbnRyYW5zaXRpb25zLmZyLy4vdmVuZG9ycy9tZXN1cmVfY3VzdG9tLnRzIiwid2VicGFjazovL3RlcnJpdG9pcmVzZW50cmFuc2l0aW9ucy5mci8uL3NyYy9zdG9yYWJsZXMvTWVzdXJlQ3VzdG9tU3RvcmFibGUudHMiLCJ3ZWJwYWNrOi8vdGVycml0b2lyZXNlbnRyYW5zaXRpb25zLmZyLy4vc3JjL2FwaS9oeWJyaWRTdG9yZS50cyIsIndlYnBhY2s6Ly90ZXJyaXRvaXJlc2VudHJhbnNpdGlvbnMuZnIvLi9zcmMvY29tcG9uZW50cy9sZWdhY3kvc3RhdHVzUGlja2VyLnRzIiwid2VicGFjazovL3RlcnJpdG9pcmVzZW50cmFuc2l0aW9ucy5mci8uL3NyYy9jb21wb25lbnRzL2xlZ2FjeS9tZXN1cmUudHMiLCJ3ZWJwYWNrOi8vdGVycml0b2lyZXNlbnRyYW5zaXRpb25zLmZyLy4vc3JjL2NvbXBvbmVudHMvbGVnYWN5L2luZGljYXRvckZvcm0udHMiLCJ3ZWJwYWNrOi8vdGVycml0b2lyZXNlbnRyYW5zaXRpb25zLmZyLy4vc3JjL2NvbXBvbmVudHMvbGVnYWN5L2luZGljYXRvcnNMaXN0LnRzIl0sIm5hbWVzIjpbImlzU3RvcmFibGUiLCJzdG9yYWJsZSIsInVuZGVmaW5lZCIsImlkIiwicGF0aG5hbWUiLCJJbmRpY2F0ZXVyVmFsdWUiLCJlcGNpX2lkIiwiaW5kaWNhdGV1cl9pZCIsInllYXIiLCJ2YWx1ZSIsInRoaXMiLCJJbmRpY2F0ZXVyVmFsdWVTdG9yYWJsZSIsImJ1aWxkSWQiLCJBUElTdG9yZSIsImhvc3QiLCJlbmRwb2ludCIsInNlcmlhbGl6ZXIiLCJkZXNlcmlhbGl6ZXIiLCJFcnJvciIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJtb2RlIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJqc29uIiwicmV0cmlldmVBdFBhdGgiLCJyZXRyaWV2ZUJ5UGF0aCIsInBhdGgiLCJzdGF0dXMiLCJkYXRhIiwicmVzdWx0cyIsImkiLCJsZW5ndGgiLCJwdXNoIiwiZ2V0Q3VycmVudEVwY2lJZCIsIlVSTFNlYXJjaFBhcmFtcyIsIndpbmRvdyIsImxvY2F0aW9uIiwic2VhcmNoIiwiZ2V0IiwiQWN0aW9uU3RhdHVzIiwiYWN0aW9uX2lkIiwiYXZhbmNlbWVudCIsIkFjdGlvblN0YXR1c1N0b3JhYmxlIiwiQWN0aW9uQ3VzdG9tIiwidWlkIiwibWVzdXJlX2lkIiwibmFtZSIsImRlc2NyaXB0aW9uIiwiQWN0aW9uQ3VzdG9tU3RvcmFibGUiLCJnZXRDdXJyZW50QVBJIiwiaG9zdG5hbWUiLCJzdWJzdHJpbmciLCJNZXN1cmVDdXN0b20iLCJjbGltYXRfcHJhdGljX3RoZW1hdGljX2lkIiwiTWVzdXJlQ3VzdG9tU3RvcmFibGUiLCJIeWJyaWRTdG9yZSIsImNhY2hlIiwicmV0cmlldmluZyIsImFwaSIsInN0b3JlZCIsInN0b3JlIiwid3JpdGVJbkNhY2hlIiwiZ2V0Q2FjaGUiLCJzdGFydHNXaXRoIiwiZGVsZXRlZCIsImRlbGV0ZUJ5SWQiLCJzdHJpcElkIiwiZmlsdGVyIiwiY2FjaGVkIiwic3BsaXQiLCJtYXRjaCIsInNsaWNlIiwiam9pbiIsInJlbW92ZUZyb21DYWNoZSIsImZpbHRlcmVkIiwicmV0cmlldmVBbGwiLCJ0aGVuIiwicmV0cmlldmVkIiwiaW5kaWNhdGV1clZhbHVlU3RvcmUiLCJzZXJpYWxpemVkIiwiYWN0aW9uU3RhdHVzU3RvcmUiLCJlY3BpSWQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZWxlbWVudCIsImFjdGlvbklkIiwiZGF0YXNldCIsImlucHV0cyIsIm9uQ2hhbmdlIiwiZXZlbnQiLCJhY3Rpb25BdmFuY2VtZW50S2V5IiwidGFyZ2V0IiwiaW5wdXQiLCJhZGRFdmVudExpc3RlbmVyIiwiYWRkTGlzdGVuZXJzIiwiYXN5bmMiLCJyZXRyaWV2ZUJ5SWQiLCJlIiwic2VsZWN0ZWRJbnB1dElkIiwiY2hlY2tlZCIsImNoZWNrSW5wdXQiLCJpbml0IiwicHJldmVudERlZmF1bHQiLCJvbkJsdXIiLCJpbnB1dFByb3BlcnRpZXMiLCJjdXJyZW50RXBjaUlkIiwib25LZXlQcmVzcyIsImtleSIsImJsdXIiLCJpbml0WWVhcmx5SW5wdXQiLCJpbmRpY2F0b3JJZCIsImluZGljYXRvclllYXIiLCJmb3JtIiwiZXBjaUlkIiwiaW5kaWNhdGV1clZhbHVlcyIsImluZGljYXRldXJWYWx1ZSJdLCJtYXBw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QndFLEVBQXFCbEIsTUFBTXRELElBTXpCcUcsRUFBY2pCLElBQ0UsVUFBZEEsRUFBTWtCLEtBQ1FsQixFQUFNRSxPQUNkaUIsUUFPUkMsRUFBa0JkLE1BQU9ILElBRTNCQSxFQUFNdkYsTUFBUyxHQUNmdUYsRUFBTUMsaUJBQWlCLE9BQVFVLEdBQy9CWCxFQUFNQyxpQkFBaUIsV0FBWWEsSUFNakNGLEVBQW1CWixJQUNkLENBQ0g3RixHQUFJNkYsRUFBTU4sUUFBUXdCLFlBQ2xCMUcsTUFBT3dGLEVBQU1OLFFBQVF5QixnQkNwRGY5QixTQUFTQyxpQkFBa0Msb0NBRW5EQyxTQUFTNkIsSUR5REtqQixPQUFRaUIsSUFDeEJBLEVBQUtuQixpQkFBaUIsU0FBVVMsR0FDaEMsTUFBTWYsRUFBU3lCLEVBQUs5QixpQkFBaUIsU0FDckMsSUFBSyxJQUFJVSxLQUFTTCxFQUNkc0IsRUFBZ0JqQixHQUdwQixNQUFNLEdBQUM3RixFQUFFLEtBQUVLLEdBQVFvRyxFQUFnQmpCLEVBQU8sSUFDcEMwQixFQUFTakYsSUFFVGtGLFFBQXlCckMsRUFBcUJ0RCxlQUNoRCxHQUFHMEYsS0FBVWxILEtBR2pCLElBQUssSUFBSTZGLEtBQVNMLEVBQVEsQ0FDdEIsTUFBTSxHQUFDeEYsRUFBRSxLQUFFSyxHQUFRb0csRUFBZ0JaLEdBQ25DLElBQUl2RixFQUFRLEdBQ1osSUFBSyxJQUFJOEcsS0FBbUJELEVBQ3BCQyxFQUFnQi9HLE1BQVFBLEdBQVErRyxFQUFnQmhILGVBQWlCSixJQUNqRU0sRUFBUThHLEVBQWdCOUcsT0FHaEN1RixFQUFNdkYsTUFBUUEsSUM5RWxCLENBQUsyRyxPIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBEYXRhIHRoYXQgY2FuIGJlIHN0b3JlZCBhdCBwYXRoL2lkLlxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBTdG9yYWJsZSB7XHJcbiAgICBpZDogc3RyaW5nLFxyXG4gICAgcGF0aG5hbWU6IHN0cmluZyxcclxufVxyXG5cclxuLyoqXHJcbiAqIFN0b3JhYmxlIHR5cGUgZ3VhcmQuXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgaXNTdG9yYWJsZSA9IChzdG9yYWJsZTogYW55KTogc3RvcmFibGUgaXMgU3RvcmFibGUgPT4ge1xyXG4gICAgcmV0dXJuIChzdG9yYWJsZSBhcyBTdG9yYWJsZSkuaWQgIT0gdW5kZWZpbmVkICYmIChzdG9yYWJsZSBhcyBTdG9yYWJsZSkucGF0aG5hbWUgIT0gdW5kZWZpbmVkXHJcbn1cclxuIiwiZXhwb3J0IGludGVyZmFjZSBJbmRpY2F0ZXVyVmFsdWVJbnRlcmZhY2Uge1xyXG4gICAgZXBjaV9pZDogc3RyaW5nLFxyXG4gICAgICAgIGluZGljYXRldXJfaWQ6IHN0cmluZyxcclxuICAgICAgICB5ZWFyOiBudW1iZXIsXHJcbiAgICAgICAgdmFsdWU6IHN0cmluZyxcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEluZGljYXRldXJWYWx1ZSB7XHJcbiAgICBwdWJsaWMgc3RhdGljIHBhdGhuYW1lOiBzdHJpbmcgPSAnaW5kaWNhdGV1cl92YWx1ZSc7XHJcbiAgICBnZXQgcGF0aG5hbWUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gSW5kaWNhdGV1clZhbHVlLnBhdGhuYW1lO1xyXG4gICAgfVxyXG4gICAgZXBjaV9pZDogc3RyaW5nO1xyXG4gICAgaW5kaWNhdGV1cl9pZDogc3RyaW5nO1xyXG4gICAgeWVhcjogbnVtYmVyO1xyXG4gICAgdmFsdWU6IHN0cmluZztcclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBJbmRpY2F0ZXVyVmFsdWUgaW5zdGFuY2UuXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKHtcclxuICAgICAgICBlcGNpX2lkLFxyXG4gICAgICAgIGluZGljYXRldXJfaWQsXHJcbiAgICAgICAgeWVhcixcclxuICAgICAgICB2YWx1ZSxcclxuICAgIH06IHtcclxuICAgICAgICBlcGNpX2lkOiBzdHJpbmcsXHJcbiAgICAgICAgaW5kaWNhdGV1cl9pZDogc3RyaW5nLFxyXG4gICAgICAgIHllYXI6IG51bWJlcixcclxuICAgICAgICB2YWx1ZTogc3RyaW5nLFxyXG4gICAgfSkge1xyXG4gICAgICAgIHRoaXMuZXBjaV9pZCA9IGVwY2lfaWQ7XHJcbiAgICAgICAgdGhpcy5pbmRpY2F0ZXVyX2lkID0gaW5kaWNhdGV1cl9pZDtcclxuICAgICAgICB0aGlzLnllYXIgPSB5ZWFyO1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcclxuICAgIH1cclxufSIsImltcG9ydCB7SW5kaWNhdGV1clZhbHVlfSBmcm9tIFwiLi4vLi4vdmVuZG9ycy9pbmRpY2F0ZXVyX3ZhbHVlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgSW5kaWNhdGV1clZhbHVlU3RvcmFibGUgZXh0ZW5kcyBJbmRpY2F0ZXVyVmFsdWUge1xyXG4gICAgc3RhdGljIGJ1aWxkSWQoZXBjaV9pZDogc3RyaW5nLCBpbmRpY2F0ZXVyX2lkOiBzdHJpbmcsIHllYXI6IG51bWJlcikgOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBgJHtlcGNpX2lkfS8ke2luZGljYXRldXJfaWR9LyR7eWVhcn1gXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGlkKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIEluZGljYXRldXJWYWx1ZVN0b3JhYmxlLmJ1aWxkSWQodGhpcy5lcGNpX2lkLCB0aGlzLmluZGljYXRldXJfaWQsIHRoaXMueWVhcilcclxuICAgIH1cclxufSIsImltcG9ydCB7aXNTdG9yYWJsZX0gZnJvbSBcIi4vc3RvcmFibGVcIjtcclxuXHJcbi8qKlxyXG4gKiBBIFN0b3JlIGZvciBTdG9yYWJsZSBvYmplY3QgdXNpbmcgYSByZW1vdGUgYXBpXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQVBJU3RvcmU8VD4ge1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBob3N0LFxyXG4gICAgICAgICAgICBlbmRwb2ludCxcclxuICAgICAgICAgICAgc2VyaWFsaXplcixcclxuICAgICAgICAgICAgZGVzZXJpYWxpemVyLFxyXG4gICAgICAgIH06IHtcclxuICAgICAgICAgICAgaG9zdDogc3RyaW5nLFxyXG4gICAgICAgICAgICBlbmRwb2ludDogc3RyaW5nLFxyXG4gICAgICAgICAgICBzZXJpYWxpemVyOiAoc3RvcmFibGU6IFQpID0+IG9iamVjdCxcclxuICAgICAgICAgICAgZGVzZXJpYWxpemVyOiAoc2VyaWFsaXplZDogb2JqZWN0KSA9PiBULFxyXG4gICAgICAgIH0pIHtcclxuICAgICAgICB0aGlzLmhvc3QgPSBob3N0O1xyXG4gICAgICAgIHRoaXMucGF0aG5hbWUgPSBlbmRwb2ludDtcclxuICAgICAgICB0aGlzLnNlcmlhbGl6ZXIgPSBzZXJpYWxpemVyO1xyXG4gICAgICAgIHRoaXMuZGVzZXJpYWxpemVyID0gZGVzZXJpYWxpemVyO1xyXG4gICAgfVxyXG5cclxuICAgIGhvc3Q6IHN0cmluZztcclxuICAgIHBhdGhuYW1lOiBzdHJpbmc7XHJcbiAgICBzZXJpYWxpemVyOiAoc3RvcmFibGU6IFQpID0+IG9iamVjdDtcclxuICAgIGRlc2VyaWFsaXplcjogKHNlcmlhbGl6ZWQ6IG9iamVjdCkgPT4gVDtcclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdG9yZSBhIFN0b3JhYmxlIGF0IHBhdGhuYW1lL2lkLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzdG9yYWJsZSB0aGUgb2JqZWN0IHRvIHNhdmVcclxuICAgICAqL1xyXG4gICAgYXN5bmMgc3RvcmUoc3RvcmFibGU6IFQpOiBQcm9taXNlPFQ+IHtcclxuICAgICAgICBpZiAoIWlzU3RvcmFibGUoc3RvcmFibGUpKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJHt0eXBlb2Ygc3RvcmFibGV9IGlzIG5vdCBzdG9yYWJsZS5gKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmhvc3R9LyR7dGhpcy5wYXRobmFtZX0vYCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgbW9kZTogJ2NvcnMnLFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh0aGlzLnNlcmlhbGl6ZXIoc3RvcmFibGUpKVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gdGhpcy5kZXNlcmlhbGl6ZXIoYXdhaXQgcmVzcG9uc2UuanNvbigpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybiBhbGwgc3RvcmFibGUgb2YgdHlwZSBUIGV4aXN0aW5nIGF0IHBhdGhuYW1lLlxyXG4gICAgICogSWYgbm90aGluZyBpcyBmb3VuZCByZXR1cm5zIGFuIGVtcHR5IHJlY29yZC5cclxuICAgICAqL1xyXG4gICAgYXN5bmMgcmV0cmlldmVBbGwoKTogUHJvbWlzZTxBcnJheTxUPj4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJldHJpZXZlQXRQYXRoKCdhbGwnKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJuIGEgc3RvcmFibGUgd2l0aCBtYXRjaGluZyBwYXRoIGFuZCBwYXRoLlxyXG4gICAgICogVGhyb3cgaWYgbm8gc3RvcmFibGUgaXMgZm91bmQgb3IgcGF0aCBkb2VzIG5vdCBleGlzdC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gaWQgU3RvcmFibGUgaWRcclxuICAgICAqL1xyXG4gICAgYXN5bmMgcmV0cmlldmVCeUlkKGlkOiBzdHJpbmcpOiBQcm9taXNlPFQgfCBudWxsPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmV0cmlldmVCeVBhdGgoaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIHJldHJpZXZlQnlQYXRoKHBhdGg6IHN0cmluZyk6IFByb21pc2U8VCB8IG51bGw+IHtcclxuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuaG9zdH0vJHt0aGlzLnBhdGhuYW1lfS8ke3BhdGh9YCwge1xyXG4gICAgICAgICAgICBtb2RlOiAnY29ycycsXHJcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gNDA0KSByZXR1cm4gbnVsbDtcclxuICAgICAgICByZXR1cm4gdGhpcy5kZXNlcmlhbGl6ZXIoYXdhaXQgcmVzcG9uc2UuanNvbigpKTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyByZXRyaWV2ZUF0UGF0aChwYXRoOiBzdHJpbmcpOiBQcm9taXNlPEFycmF5PFQ+PiB7XHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLmhvc3R9LyR7dGhpcy5wYXRobmFtZX0vJHtwYXRofWAsIHtcclxuICAgICAgICAgICAgbW9kZTogJ2NvcnMnLFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaCh0aGlzLmRlc2VyaWFsaXplcihkYXRhW2ldKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0cztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIERlbGV0ZSBhIFN0b3JhYmxlIHN0b3JlZCBhdCBwYXRobmFtZS9pZC5cclxuICAgICAqIFJldHVybiB0cnVlIGlmIHNvbWV0aGluZyB3YXMgZGVsZXRlZCwgZmFsc2UgaWYgbm90aGluZyBleGlzdHMgYXQgcGF0aG5hbWUvaWQuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGlkIFN0b3JhYmxlIGlkXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIGRlbGV0ZUJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5ob3N0fS8ke3RoaXMucGF0aG5hbWV9LyR7aWR9YCwge1xyXG4gICAgICAgICAgICBtb2RlOiAnY29ycycsXHJcbiAgICAgICAgICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMgPT0gMjAwO1xyXG4gICAgfVxyXG59XHJcbiIsImV4cG9ydCBjb25zdCBnZXRDdXJyZW50RXBjaUlkID0gKCk6IHN0cmluZyA9PiB7XHJcbiAgICBjb25zdCB1cmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpXHJcbiAgICBjb25zdCBpZCA9IHVybFBhcmFtcy5nZXQoJ2VwY2lfaWQnKVxyXG5cclxuICAgIGlmICghaWQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhcmFtZXRlciBlcGNpX2lkIGlzIGVtcHR5LicpXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGlkXHJcbn0iLCJleHBvcnQgaW50ZXJmYWNlIEFjdGlvblN0YXR1c0ludGVyZmFjZSB7XHJcbiAgICBhY3Rpb25faWQ6IHN0cmluZyxcclxuICAgICAgICBlcGNpX2lkOiBzdHJpbmcsXHJcbiAgICAgICAgYXZhbmNlbWVudDogc3RyaW5nLFxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQWN0aW9uU3RhdHVzIHtcclxuICAgIHB1YmxpYyBzdGF0aWMgcGF0aG5hbWU6IHN0cmluZyA9ICdhY3Rpb25fc3RhdHVzJztcclxuICAgIGdldCBwYXRobmFtZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBBY3Rpb25TdGF0dXMucGF0aG5hbWU7XHJcbiAgICB9XHJcbiAgICBhY3Rpb25faWQ6IHN0cmluZztcclxuICAgIGVwY2lfaWQ6IHN0cmluZztcclxuICAgIGF2YW5jZW1lbnQ6IHN0cmluZztcclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBBY3Rpb25TdGF0dXMgaW5zdGFuY2UuXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKHtcclxuICAgICAgICBhY3Rpb25faWQsXHJcbiAgICAgICAgZXBjaV9pZCxcclxuICAgICAgICBhdmFuY2VtZW50LFxyXG4gICAgfToge1xyXG4gICAgICAgIGFjdGlvbl9pZDogc3RyaW5nLFxyXG4gICAgICAgIGVwY2lfaWQ6IHN0cmluZyxcclxuICAgICAgICBhdmFuY2VtZW50OiBzdHJpbmcsXHJcbiAgICB9KSB7XHJcbiAgICAgICAgdGhpcy5hY3Rpb25faWQgPSBhY3Rpb25faWQ7XHJcbiAgICAgICAgdGhpcy5lcGNpX2lkID0gZXBjaV9pZDtcclxuICAgICAgICB0aGlzLmF2YW5jZW1lbnQgPSBhdmFuY2VtZW50O1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHtBY3Rpb25TdGF0dXN9IGZyb20gXCIuLi8uLi92ZW5kb3JzL2FjdGlvbl9zdGF0dXNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBBY3Rpb25TdGF0dXNTdG9yYWJsZSBleHRlbmRzIEFjdGlvblN0YXR1cyB7XHJcbiAgICBzdGF0aWMgYnVpbGRJZChlcGNpX2lkOiBzdHJpbmcsIGFjdGlvbl9pZDogc3RyaW5nKSA6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIGAke2VwY2lfaWR9LyR7YWN0aW9uX2lkfWA7XHJcbiAgICB9XHJcbiAgICBnZXQgaWQoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gQWN0aW9uU3RhdHVzU3RvcmFibGUuYnVpbGRJZCh0aGlzLmVwY2lfaWQsIHRoaXMuYWN0aW9uX2lkKVxyXG4gICAgfVxyXG59IiwiZXhwb3J0IGludGVyZmFjZSBBY3Rpb25DdXN0b21JbnRlcmZhY2Uge1xyXG4gICAgdWlkOiBzdHJpbmcsXHJcbiAgICAgICAgZXBjaV9pZDogc3RyaW5nLFxyXG4gICAgICAgIG1lc3VyZV9pZDogc3RyaW5nLFxyXG4gICAgICAgIG5hbWU6IHN0cmluZyxcclxuICAgICAgICBkZXNjcmlwdGlvbjogc3RyaW5nLFxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQWN0aW9uQ3VzdG9tIHtcclxuICAgIHB1YmxpYyBzdGF0aWMgcGF0aG5hbWU6IHN0cmluZyA9ICdhY3Rpb25fY3VzdG9tJztcclxuICAgIGdldCBwYXRobmFtZSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBBY3Rpb25DdXN0b20ucGF0aG5hbWU7XHJcbiAgICB9XHJcbiAgICB1aWQ6IHN0cmluZztcclxuICAgIGVwY2lfaWQ6IHN0cmluZztcclxuICAgIG1lc3VyZV9pZDogc3RyaW5nO1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcclxuXHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBBY3Rpb25DdXN0b20gaW5zdGFuY2UuXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKHtcclxuICAgICAgICB1aWQsXHJcbiAgICAgICAgZXBjaV9pZCxcclxuICAgICAgICBtZXN1cmVfaWQsXHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBkZXNjcmlwdGlvbixcclxuICAgIH06IHtcclxuICAgICAgICB1aWQ6IHN0cmluZyxcclxuICAgICAgICBlcGNpX2lkOiBzdHJpbmcsXHJcbiAgICAgICAgbWVzdXJlX2lkOiBzdHJpbmcsXHJcbiAgICAgICAgbmFtZTogc3RyaW5nLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBzdHJpbmcsXHJcbiAgICB9KSB7XHJcbiAgICAgICAgdGhpcy51aWQgPSB1aWQ7XHJcbiAgICAgICAgdGhpcy5lcGNpX2lkID0gZXBjaV9pZDtcclxuICAgICAgICB0aGlzLm1lc3VyZV9pZCA9IG1lc3VyZV9pZDtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcclxuICAgIH1cclxufSIsImltcG9ydCB7QWN0aW9uQ3VzdG9tfSBmcm9tIFwiLi4vLi4vdmVuZG9ycy9hY3Rpb25fY3VzdG9tXCI7XHJcblxyXG5leHBvcnQgIGNsYXNzIEFjdGlvbkN1c3RvbVN0b3JhYmxlIGV4dGVuZHMgQWN0aW9uQ3VzdG9tIHtcclxuICAgIHN0YXRpYyBidWlsZElkKGVwY2lfaWQ6IHN0cmluZywgbWVzdXJlX2lkOiBzdHJpbmcsIHVpZDogc3RyaW5nKSA6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIGAke2VwY2lfaWR9LyR7bWVzdXJlX2lkfS8ke3VpZH1gXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGlkKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIEFjdGlvbkN1c3RvbVN0b3JhYmxlLmJ1aWxkSWQodGhpcy5lcGNpX2lkLCB0aGlzLm1lc3VyZV9pZCwgdGhpcy51aWQpXHJcbiAgICB9XHJcbn0iLCJleHBvcnQgY29uc3QgZ2V0Q3VycmVudEFQSSA9ICgpOiBzdHJpbmcgPT4ge1xyXG4gICAgY29uc3QgaG9zdG5hbWUgPSB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWU7XHJcbiAgICBpZiAoaG9zdG5hbWUuc3Vic3RyaW5nKDAsIDEwKSA9PT0gJ2xvY2FsaG9zdCcpIHJldHVybiAnaHR0cDovL2xvY2FsaG9zdDo4MDAwJztcclxuICAgIGlmIChob3N0bmFtZSA9PT0gJ3NhbmRib3gudGVycml0b2lyZXNlbnRyYW5zaXRpb25zLmZyJykgcmV0dXJuICdodHRwczovL3NhbmRib3h0ZXJyaXRvaXJlcy5vc2MtZnIxLnNjYWxpbmdvLmlvJ1xyXG4gICAgaWYgKGhvc3RuYW1lID09PSAnc3RhZ2luZy50ZXJyaXRvaXJlc2VudHJhbnNpdGlvbnMuZnInKSByZXR1cm4gJ2h0dHBzOi8vdGVycml0b2lyZXNlbnRyYW5zaXRpb25zLm9zYy1mcjEuc2NhbGluZ28uaW8nXHJcbiAgICB0aHJvdyBgbm8gQVBJIGhvc3QgZm9yICR7aG9zdG5hbWV9YFxyXG59IiwiZXhwb3J0IGludGVyZmFjZSBNZXN1cmVDdXN0b21JbnRlcmZhY2Uge1xyXG4gICAgdWlkOiBzdHJpbmcsXHJcbiAgICAgICAgZXBjaV9pZDogc3RyaW5nLFxyXG4gICAgICAgIGNsaW1hdF9wcmF0aWNfdGhlbWF0aWNfaWQ6IHN0cmluZyxcclxuICAgICAgICBuYW1lOiBzdHJpbmcsXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNZXN1cmVDdXN0b20ge1xyXG4gICAgcHVibGljIHN0YXRpYyBwYXRobmFtZTogc3RyaW5nID0gJ21lc3VyZV9jdXN0b20nO1xyXG4gICAgZ2V0IHBhdGhuYW1lKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIE1lc3VyZUN1c3RvbS5wYXRobmFtZTtcclxuICAgIH1cclxuICAgIHVpZDogc3RyaW5nO1xyXG4gICAgZXBjaV9pZDogc3RyaW5nO1xyXG4gICAgY2xpbWF0X3ByYXRpY190aGVtYXRpY19pZDogc3RyaW5nO1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIE1lc3VyZUN1c3RvbSBpbnN0YW5jZS5cclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3Ioe1xyXG4gICAgICAgIHVpZCxcclxuICAgICAgICBlcGNpX2lkLFxyXG4gICAgICAgIGNsaW1hdF9wcmF0aWNfdGhlbWF0aWNfaWQsXHJcbiAgICAgICAgbmFtZSxcclxuICAgIH06IHtcclxuICAgICAgICB1aWQ6IHN0cmluZyxcclxuICAgICAgICBlcGNpX2lkOiBzdHJpbmcsXHJcbiAgICAgICAgY2xpbWF0X3ByYXRpY190aGVtYXRpY19pZDogc3RyaW5nLFxyXG4gICAgICAgIG5hbWU6IHN0cmluZyxcclxuICAgIH0pIHtcclxuICAgICAgICB0aGlzLnVpZCA9IHVpZDtcclxuICAgICAgICB0aGlzLmVwY2lfaWQgPSBlcGNpX2lkO1xyXG4gICAgICAgIHRoaXMuY2xpbWF0X3ByYXRpY190aGVtYXRpY19pZCA9IGNsaW1hdF9wcmF0aWNfdGhlbWF0aWNfaWQ7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgIH1cclxufSIsImltcG9ydCB7TWVzdXJlQ3VzdG9tfSBmcm9tIFwiLi4vLi4vdmVuZG9ycy9tZXN1cmVfY3VzdG9tXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgTWVzdXJlQ3VzdG9tU3RvcmFibGUgZXh0ZW5kcyBNZXN1cmVDdXN0b20ge1xyXG4gICAgc3RhdGljIGJ1aWxkSWQoZXBjaV9pZDogc3RyaW5nLCB1aWQ6IHN0cmluZykgOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBgJHtlcGNpX2lkfS8ke3VpZH1gO1xyXG4gICAgfVxyXG4gICAgZ2V0IGlkKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIE1lc3VyZUN1c3RvbVN0b3JhYmxlLmJ1aWxkSWQodGhpcy5lcGNpX2lkLCB0aGlzLnVpZClcclxuICAgIH1cclxufSIsImltcG9ydCB7aXNTdG9yYWJsZSwgU3RvcmFibGV9IGZyb20gXCIuL3N0b3JhYmxlXCI7XHJcbmltcG9ydCB7SW5kaWNhdGV1clZhbHVlU3RvcmFibGV9IGZyb20gXCIuLi9zdG9yYWJsZXMvSW5kaWNhdGV1clZhbHVlU3RvcmFibGVcIjtcclxuaW1wb3J0IHtJbmRpY2F0ZXVyVmFsdWUsIEluZGljYXRldXJWYWx1ZUludGVyZmFjZX0gZnJvbSBcIi4uLy4uL3ZlbmRvcnMvaW5kaWNhdGV1cl92YWx1ZVwiO1xyXG5pbXBvcnQge0FQSVN0b3JlfSBmcm9tIFwiLi9hcGlTdG9yZVwiO1xyXG5pbXBvcnQge2dldEN1cnJlbnRFcGNpSWR9IGZyb20gXCIuL2N1cnJlbnRFcGNpXCI7XHJcbmltcG9ydCB7QWN0aW9uU3RhdHVzLCBBY3Rpb25TdGF0dXNJbnRlcmZhY2V9IGZyb20gXCIuLi8uLi92ZW5kb3JzL2FjdGlvbl9zdGF0dXNcIjtcclxuaW1wb3J0IHtBY3Rpb25TdGF0dXNTdG9yYWJsZX0gZnJvbSBcIi4uL3N0b3JhYmxlcy9BY3Rpb25TdGF0dXNTdG9yYWJsZVwiO1xyXG5pbXBvcnQge0FjdGlvbkN1c3RvbVN0b3JhYmxlfSBmcm9tIFwiLi4vc3RvcmFibGVzL0FjdGlvbkN1c3RvbVN0b3JhYmxlXCI7XHJcbmltcG9ydCB7QWN0aW9uQ3VzdG9tLCBBY3Rpb25DdXN0b21JbnRlcmZhY2V9IGZyb20gXCIuLi8uLi92ZW5kb3JzL2FjdGlvbl9jdXN0b21cIjtcclxuaW1wb3J0IHtnZXRDdXJyZW50QVBJfSBmcm9tIFwiLi9jdXJyZW50QVBJXCI7XHJcbmltcG9ydCB7TWVzdXJlQ3VzdG9tU3RvcmFibGV9IGZyb20gXCIuLi9zdG9yYWJsZXMvTWVzdXJlQ3VzdG9tU3RvcmFibGVcIjtcclxuaW1wb3J0IHtNZXN1cmVDdXN0b20sIE1lc3VyZUN1c3RvbUludGVyZmFjZX0gZnJvbSBcIi4uLy4uL3ZlbmRvcnMvbWVzdXJlX2N1c3RvbVwiO1xyXG5cclxuLyoqXHJcbiAqIEEgU3RvcmUgZm9yIFN0b3JhYmxlIG9iamVjdCB1c2luZyBhIHJlbW90ZSBhcGkgYW5kIGEgbG9jYWwgY2FjaGUuXHJcbiAqXHJcbiAqIFRoZSBsb2NhbCBjYWNoZSBpcyBrZXB0IGluIG1lbW9yeSBmb3Igbm93LlxyXG4gKi9cclxuY2xhc3MgSHlicmlkU3RvcmU8VCBleHRlbmRzIFN0b3JhYmxlPiB7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGhvc3QsXHJcbiAgICAgICAgICAgIGVuZHBvaW50LFxyXG4gICAgICAgICAgICBzZXJpYWxpemVyLFxyXG4gICAgICAgICAgICBkZXNlcmlhbGl6ZXIsXHJcbiAgICAgICAgfToge1xyXG4gICAgICAgICAgICBob3N0OiBzdHJpbmcsXHJcbiAgICAgICAgICAgIGVuZHBvaW50OiBzdHJpbmcsXHJcbiAgICAgICAgICAgIHNlcmlhbGl6ZXI6IChzdG9yYWJsZTogVCkgPT4gb2JqZWN0LFxyXG4gICAgICAgICAgICBkZXNlcmlhbGl6ZXI6IChzZXJpYWxpemVkOiBvYmplY3QpID0+IFQsXHJcbiAgICAgICAgfSkge1xyXG4gICAgICAgIHRoaXMuaG9zdCA9IGhvc3Q7XHJcbiAgICAgICAgdGhpcy5wYXRobmFtZSA9IGVuZHBvaW50O1xyXG4gICAgICAgIHRoaXMuc2VyaWFsaXplciA9IHNlcmlhbGl6ZXI7XHJcbiAgICAgICAgdGhpcy5kZXNlcmlhbGl6ZXIgPSBkZXNlcmlhbGl6ZXI7XHJcblxyXG4gICAgICAgIHRoaXMuYXBpID0gbmV3IEFQSVN0b3JlPFQ+KHtcclxuICAgICAgICAgICAgaG9zdDogdGhpcy5ob3N0LFxyXG4gICAgICAgICAgICBlbmRwb2ludDogdGhpcy5wYXRobmFtZSxcclxuICAgICAgICAgICAgc2VyaWFsaXplcjogdGhpcy5zZXJpYWxpemVyLFxyXG4gICAgICAgICAgICBkZXNlcmlhbGl6ZXI6IHRoaXMuZGVzZXJpYWxpemVyXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8qXHJcbiAgICAgICAgdG9kbyB1c2UgbG9jYWwgc3RvcmUgZm9yIGNhY2hpbmdcclxuICAgICAgICB0aGlzLmxvY2FsID0gbmV3IExvY2FsU3RvcmU8VD4oe1xyXG4gICAgICAgICAgICBwYXRobmFtZTogdGhpcy5wYXRobmFtZSxcclxuICAgICAgICAgICAgc2VyaWFsaXplcjogdGhpcy5zZXJpYWxpemVyLFxyXG4gICAgICAgICAgICBkZXNlcmlhbGl6ZXI6IHRoaXMuZGVzZXJpYWxpemVyXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgKi9cclxuICAgIH1cclxuXHJcbiAgICBob3N0OiBzdHJpbmc7XHJcbiAgICBwYXRobmFtZTogc3RyaW5nO1xyXG4gICAgc2VyaWFsaXplcjogKHN0b3JhYmxlOiBUKSA9PiBvYmplY3Q7XHJcbiAgICBkZXNlcmlhbGl6ZXI6IChzZXJpYWxpemVkOiBvYmplY3QpID0+IFQ7XHJcbiAgICBhcGk6IEFQSVN0b3JlPFQ+O1xyXG4gICAgcHJpdmF0ZSBjYWNoZTogVFtdIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gICAgLy8gbG9jYWw6IExvY2FsU3RvcmU8VD47XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3RvcmUgYSBTdG9yYWJsZSBhdCBwYXRobmFtZS9pZC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc3RvcmFibGUgdGhlIG9iamVjdCB0byBzYXZlXHJcbiAgICAgKi9cclxuICAgIGFzeW5jIHN0b3JlKHN0b3JhYmxlOiBUKTogUHJvbWlzZTxUPiB7XHJcbiAgICAgICAgaWYgKCFpc1N0b3JhYmxlKHN0b3JhYmxlKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7dHlwZW9mIHN0b3JhYmxlfSBpcyBub3Qgc3RvcmFibGUuYClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IHN0b3JlZCA9IGF3YWl0IHRoaXMuYXBpLnN0b3JlKHN0b3JhYmxlKTtcclxuICAgICAgICByZXR1cm4gdGhpcy53cml0ZUluQ2FjaGUoc3RvcmVkKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm4gYWxsIHN0b3JhYmxlIG9mIHR5cGUgVCBleGlzdGluZyBhdCBwYXRobmFtZS5cclxuICAgICAqIElmIG5vdGhpbmcgaXMgZm91bmQgcmV0dXJucyBhbiBlbXB0eSByZWNvcmQuXHJcbiAgICAgKi9cclxuICAgIHJldHJpZXZlQWxsKCk6IFByb21pc2U8QXJyYXk8VD4+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRDYWNoZSgpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybiBhIHN0b3JhYmxlIHdpdGggbWF0Y2hpbmcgaWQuXHJcbiAgICAgKiBUaHJvdyBpZiBubyBzdG9yYWJsZSBpcyBmb3VuZCBvciBwYXRoIGRvZXMgbm90IGV4aXN0LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpZCBTdG9yYWJsZSBpZFxyXG4gICAgICovXHJcbiAgICBhc3luYyByZXRyaWV2ZUJ5SWQoaWQ6IHN0cmluZyk6IFByb21pc2U8VCB8IG51bGw+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZXRyaWV2ZUJ5UGF0aChpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm4gYSBzdG9yYWJsZSB3aXRoIG1hdGNoaW5nIHBhdGguXHJcbiAgICAgKiBUaHJvdyBpZiBubyBzdG9yYWJsZSBpcyBmb3VuZCBvciBwYXRoIGRvZXMgbm90IGV4aXN0LlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBwYXRoIFN0b3JhYmxlIHBhdGhcclxuICAgICAqL1xyXG4gICAgYXN5bmMgcmV0cmlldmVCeVBhdGgocGF0aDogc3RyaW5nKTogUHJvbWlzZTxUIHwgbnVsbD4ge1xyXG4gICAgICAgIGNvbnN0IGNhY2hlID0gYXdhaXQgdGhpcy5nZXRDYWNoZSgpO1xyXG4gICAgICAgIGZvciAobGV0IHN0b3JhYmxlIG9mIGNhY2hlKSB7XHJcbiAgICAgICAgICAgIGlmIChzdG9yYWJsZS5pZC5zdGFydHNXaXRoKHBhdGgpKSByZXR1cm4gc3RvcmFibGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJuIGFsbCBzdG9yYWJsZSBvZiB0eXBlIFQgZXhpc3RpbmcgYXQgcGF0aCB1bmRlciBwYXRobmFtZS5cclxuICAgICAqIElmIG5vdGhpbmcgaXMgZm91bmQgcmV0dXJucyBhbiBlbXB0eSBsaXN0LlxyXG4gICAgICovXHJcbiAgICBhc3luYyByZXRyaWV2ZUF0UGF0aChwYXRoOiBzdHJpbmcpOiBQcm9taXNlPEFycmF5PFQ+PiB7XHJcbiAgICAgICAgY29uc3QgY2FjaGUgPSBhd2FpdCB0aGlzLmdldENhY2hlKCk7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IFtdO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBzdG9yYWJsZSBvZiBjYWNoZSkge1xyXG4gICAgICAgICAgICBpZiAoc3RvcmFibGUuaWQuc3RhcnRzV2l0aChwYXRoKSkgcmVzdWx0cy5wdXNoKHN0b3JhYmxlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHRzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRGVsZXRlIGEgU3RvcmFibGUgc3RvcmVkIGF0IHBhdGhuYW1lL2lkLlxyXG4gICAgICogUmV0dXJuIHRydWUgaWYgc29tZXRoaW5nIHdhcyBkZWxldGVkLCBmYWxzZSBpZiBub3RoaW5nIGV4aXN0cyBhdCBwYXRobmFtZS9pZC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gaWQgU3RvcmFibGUgaWRcclxuICAgICAqL1xyXG4gICAgYXN5bmMgZGVsZXRlQnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICAgICAgY29uc3QgZGVsZXRlZCA9IGF3YWl0IHRoaXMuYXBpLmRlbGV0ZUJ5SWQodGhpcy5zdHJpcElkKGlkKSk7XHJcbiAgICAgICAgY29uc3QgY2FjaGUgPSBhd2FpdCB0aGlzLmdldENhY2hlKCk7XHJcbiAgICAgICAgdGhpcy5jYWNoZSA9IGNhY2hlLmZpbHRlcihjYWNoZWQgPT4gY2FjaGVkLmlkICE9PSBpZCk7XHJcbiAgICAgICAgcmV0dXJuIGRlbGV0ZWQ7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU3RyaXAgaWQgcmVtb3ZlcyByZWR1bmRhbnQgcGFydHMgc2hhcmVkIGJ5IHRoZSBpZCBhbmQgdGhlIGVuZHBvaW50LlxyXG4gICAgICpcclxuICAgICAqIEV4OiBpZiB0aGUgZW5kcG9pbnQgcGF0aCBpcyBgdjEvZW5kcG9pbnQvZXBjaV9pZC9gXHJcbiAgICAgKiBhbmQgdGhlIGlkIGlzIGBlcGNpX2lkL3BhcnRfYS9wYXJ0X2JgXHJcbiAgICAgKiB0aGUgcmVzdWx0aW5nIHN0cmlwcGVkIGlkIHdvdWxkIGJlIGBwYXJ0X2EvcGFydF9iYCxcclxuICAgICAqIGEgcGF0aCByZW1vdmVkIGZyb20gdGhlIHJlZHVuZGFudCBwYXJ0IGBlcGNpX2lkYFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHN0cmlwSWQoaWQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgY29uc3QgZW5kcG9pbnQgPSB0aGlzLnBhdGhuYW1lLnNwbGl0KCcvJyk7XHJcbiAgICAgICAgbGV0IHBhdGggPSBpZC5zcGxpdCgnLycpO1xyXG4gICAgICAgIGxldCBtYXRjaCA9IGZhbHNlO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVuZHBvaW50Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBwYXJ0ID0gZW5kcG9pbnRbaV07XHJcbiAgICAgICAgICAgIGlmIChwYXJ0ID09IHBhdGhbMF0pIHtcclxuICAgICAgICAgICAgICAgIG1hdGNoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHBhdGggPSBwYXRoLnNsaWNlKDEpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKG1hdGNoKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHBhdGguam9pbignLycpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXN5bmMgd3JpdGVJbkNhY2hlKHN0b3JhYmxlOiBUKTogUHJvbWlzZTxUPiB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5yZW1vdmVGcm9tQ2FjaGUoc3RvcmFibGUuaWQpO1xyXG4gICAgICAgIGNvbnN0IGNhY2hlID0gYXdhaXQgdGhpcy5nZXRDYWNoZSgpO1xyXG4gICAgICAgIGNhY2hlLnB1c2goc3RvcmFibGUpO1xyXG4gICAgICAgIHRoaXMuY2FjaGUgPSBjYWNoZTtcclxuICAgICAgICByZXR1cm4gc3RvcmFibGU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhc3luYyByZW1vdmVGcm9tQ2FjaGUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgICAgIGNvbnN0IGNhY2hlID0gYXdhaXQgdGhpcy5nZXRDYWNoZSgpO1xyXG4gICAgICAgIGNvbnN0IGZpbHRlcmVkID0gY2FjaGUuZmlsdGVyKGNhY2hlZCA9PiBjYWNoZWQuaWQgIT09IGlkKTtcclxuICAgICAgICBjb25zdCBkZWxldGVkID0gZmlsdGVyZWQubGVuZ3RoICE9IGNhY2hlLmxlbmd0aDtcclxuICAgICAgICB0aGlzLmNhY2hlID0gZmlsdGVyZWQ7XHJcbiAgICAgICAgcmV0dXJuIGRlbGV0ZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhc3luYyBnZXRDYWNoZSgpOiBQcm9taXNlPEFycmF5PFQ+PiB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2FjaGUgIT09IG51bGwpIHJldHVybiB0aGlzLmNhY2hlO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5yZXRyaWV2aW5nID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmV0cmlldmluZyA9IHRoaXMuYXBpLnJldHJpZXZlQWxsKCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLnJldHJpZXZpbmcudGhlbigocmV0cmlldmVkKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlID0gcmV0cmlldmVkO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmV0cmlldmluZztcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJldHJpZXZpbmc6IFByb21pc2U8QXJyYXk8VD4+IHwgbnVsbCA9IG51bGw7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgY29uc3QgaW5kaWNhdGV1clZhbHVlU3RvcmUgPSBuZXcgSHlicmlkU3RvcmU8SW5kaWNhdGV1clZhbHVlU3RvcmFibGU+KHtcclxuICAgIGhvc3Q6IGdldEN1cnJlbnRBUEkoKSxcclxuICAgIGVuZHBvaW50OiBgdjEvJHtJbmRpY2F0ZXVyVmFsdWUucGF0aG5hbWV9LyR7Z2V0Q3VycmVudEVwY2lJZCgpfWAsXHJcbiAgICBzZXJpYWxpemVyOiAoc3RvcmFibGUpID0+IHN0b3JhYmxlLFxyXG4gICAgZGVzZXJpYWxpemVyOiAoc2VyaWFsaXplZCkgPT4gbmV3IEluZGljYXRldXJWYWx1ZVN0b3JhYmxlKHNlcmlhbGl6ZWQgYXMgSW5kaWNhdGV1clZhbHVlSW50ZXJmYWNlKSxcclxufSk7XHJcblxyXG5leHBvcnQgY29uc3QgYWN0aW9uU3RhdHVzU3RvcmUgPSBuZXcgSHlicmlkU3RvcmU8QWN0aW9uU3RhdHVzU3RvcmFibGU+KHtcclxuICAgIGhvc3Q6IGdldEN1cnJlbnRBUEkoKSxcclxuICAgIGVuZHBvaW50OiBgdjEvJHtBY3Rpb25TdGF0dXMucGF0aG5hbWV9LyR7Z2V0Q3VycmVudEVwY2lJZCgpfWAsXHJcbiAgICBzZXJpYWxpemVyOiAoc3RvcmFibGUpID0+IHN0b3JhYmxlLFxyXG4gICAgZGVzZXJpYWxpemVyOiAoc2VyaWFsaXplZCkgPT4gbmV3IEFjdGlvblN0YXR1c1N0b3JhYmxlKHNlcmlhbGl6ZWQgYXMgQWN0aW9uU3RhdHVzSW50ZXJmYWNlKSxcclxufSk7XHJcblxyXG5leHBvcnQgY29uc3QgYWN0aW9uQ3VzdG9tU3RvcmUgPSBuZXcgSHlicmlkU3RvcmU8QWN0aW9uQ3VzdG9tU3RvcmFibGU+KHtcclxuICAgIGhvc3Q6IGdldEN1cnJlbnRBUEkoKSxcclxuICAgIGVuZHBvaW50OiBgdjEvJHtBY3Rpb25DdXN0b20ucGF0aG5hbWV9LyR7Z2V0Q3VycmVudEVwY2lJZCgpfWAsXHJcbiAgICBzZXJpYWxpemVyOiAoc3RvcmFibGUpID0+IHN0b3JhYmxlLFxyXG4gICAgZGVzZXJpYWxpemVyOiAoc2VyaWFsaXplZCkgPT4gbmV3IEFjdGlvbkN1c3RvbVN0b3JhYmxlKHNlcmlhbGl6ZWQgYXMgQWN0aW9uQ3VzdG9tSW50ZXJmYWNlKSxcclxufSk7XHJcblxyXG5leHBvcnQgY29uc3QgbWVzdXJlQ3VzdG9tU3RvcmUgPSBuZXcgSHlicmlkU3RvcmU8TWVzdXJlQ3VzdG9tU3RvcmFibGU+KHtcclxuICAgIGhvc3Q6IGdldEN1cnJlbnRBUEkoKSxcclxuICAgIGVuZHBvaW50OiBgdjEvJHtNZXN1cmVDdXN0b20ucGF0aG5hbWV9LyR7Z2V0Q3VycmVudEVwY2lJZCgpfWAsXHJcbiAgICBzZXJpYWxpemVyOiAoc3RvcmFibGUpID0+IHN0b3JhYmxlLFxyXG4gICAgZGVzZXJpYWxpemVyOiAoc2VyaWFsaXplZCkgPT4gbmV3IE1lc3VyZUN1c3RvbVN0b3JhYmxlKHNlcmlhbGl6ZWQgYXMgTWVzdXJlQ3VzdG9tSW50ZXJmYWNlKSxcclxufSk7IiwiaW1wb3J0IHthY3Rpb25TdGF0dXNTdG9yZX0gZnJvbSBcIi4uLy4uL2FwaS9oeWJyaWRTdG9yZVwiO1xyXG5pbXBvcnQge2dldEN1cnJlbnRFcGNpSWR9IGZyb20gXCIuLi8uLi9hcGkvY3VycmVudEVwY2lcIjtcclxuaW1wb3J0IHtBY3Rpb25TdGF0dXNTdG9yYWJsZX0gZnJvbSBcIi4uLy4uL3N0b3JhYmxlcy9BY3Rpb25TdGF0dXNTdG9yYWJsZVwiO1xyXG5cclxuY29uc3QgZWNwaUlkID0gZ2V0Q3VycmVudEVwY2lJZCgpXHJcblxyXG5jb25zdCBhZGRMaXN0ZW5lcnMgPSAoYWN0aW9uSWQ6IHN0cmluZywgaW5wdXRzOiBOb2RlTGlzdE9mPEhUTUxJbnB1dEVsZW1lbnQ+KTogdm9pZCA9PiB7XHJcbiAgICBsZXQgb25DaGFuZ2UgPSAoZXZlbnQ6IEV2ZW50KTogdm9pZCA9PiB7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnRcclxuICAgICAgICBjb25zdCBhY3Rpb25BdmFuY2VtZW50S2V5ID0gdGFyZ2V0LnZhbHVlXHJcbiAgICAgICAgY29uc3QgYXZhbmNlbWVudCA9IG5ldyBBY3Rpb25TdGF0dXNTdG9yYWJsZSh7XHJcbiAgICAgICAgICAgIGVwY2lfaWQ6IGVjcGlJZCxcclxuICAgICAgICAgICAgYWN0aW9uX2lkOiBhY3Rpb25JZCxcclxuICAgICAgICAgICAgYXZhbmNlbWVudDogYWN0aW9uQXZhbmNlbWVudEtleVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIGFjdGlvblN0YXR1c1N0b3JlLnN0b3JlKGF2YW5jZW1lbnQpXHJcbiAgICB9XHJcblxyXG4gICAgaW5wdXRzLmZvckVhY2goKGlucHV0KTogdm9pZCA9PiB7XHJcbiAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25DaGFuZ2UpXHJcbiAgICB9KVxyXG59XHJcblxyXG4vKipcclxuICogQ2hlY2sgdGhlIHZhbHVlIG9mIHRoZSBzdGF0dXMgcGlja2VyIHdpdGggYSBkZWZhdWx0IHZhbHVlIG9yIHRoZSB2YWx1ZSByZXRyaWV2ZWQgZnJvbSBzdG9yZS5cclxuICovXHJcbmNvbnN0IGNoZWNrSW5wdXQgPSBhc3luYyAoYWN0aW9uSWQ6IHN0cmluZywgaW5wdXRzOiBOb2RlTGlzdE9mPEhUTUxJbnB1dEVsZW1lbnQ+KTogUHJvbWlzZTx2b2lkPiA9PiB7XHJcbiAgICBsZXQgYWN0aW9uQXZhbmNlbWVudEtleSA9ICdwYXNfZmFpdGUnO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBzdGF0dXMgPSBhd2FpdCBhY3Rpb25TdGF0dXNTdG9yZS5yZXRyaWV2ZUJ5SWQoYCR7ZWNwaUlkfS8ke2FjdGlvbklkfWApXHJcbiAgICAgICAgaWYgKHN0YXR1cykgYWN0aW9uQXZhbmNlbWVudEtleSA9IHN0YXR1cy5hdmFuY2VtZW50O1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIC8vICBzaG91bGQgZG8gc29tZXRoaW5nIG1lYW5pbmdmdWwuXHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICAgIGNvbnN0IHNlbGVjdGVkSW5wdXRJZCA9IGBhY3Rpb24tJHthY3Rpb25JZH1fJHthY3Rpb25BdmFuY2VtZW50S2V5fWBcclxuICAgICAgICBpbnB1dHMuZm9yRWFjaCgoaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQpOiB2b2lkID0+IHtcclxuICAgICAgICAgICAgaWYgKGlucHV0LmlkID09PSBzZWxlY3RlZElucHV0SWQpIGlucHV0LmNoZWNrZWQgPSB0cnVlXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIHRoZSBzdGF0dXMgcGlja2VyIG9mIGFuIGFjdGlvbiB3aXRoIGFsbCBpdHMgZXZlbnQgbGlzdGVuZXJzXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgaW5pdCA9IChlbGVtZW50OiBIVE1MRmllbGRTZXRFbGVtZW50KTogdm9pZCA9PiB7XHJcbiAgICBsZXQgYWN0aW9uSWQgPSBlbGVtZW50LmRhdGFzZXQuYWN0aW9uSWQgfHwgJydcclxuICAgIGxldCBpbnB1dHMgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGw8SFRNTElucHV0RWxlbWVudD4oJ2lucHV0W3R5cGU9XCJyYWRpb1wiXScpXHJcblxyXG4gICAgYWRkTGlzdGVuZXJzKGFjdGlvbklkLCBpbnB1dHMpXHJcbiAgICBjaGVja0lucHV0KGFjdGlvbklkLCBpbnB1dHMpXHJcbn0iLCJpbXBvcnQgeyBpbml0IH0gZnJvbSAnLi9zdGF0dXNQaWNrZXInXHJcblxyXG5sZXQgc3RhdHVzUGlja2VycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGw8SFRNTEZpZWxkU2V0RWxlbWVudD4oJy5zdGF0dXMnKVxyXG5cclxuc3RhdHVzUGlja2Vycy5mb3JFYWNoKChlbGVtZW50KTogdm9pZCA9PiBpbml0KGVsZW1lbnQpKVxyXG5cclxuXHJcbiIsImltcG9ydCB7aW5kaWNhdGV1clZhbHVlU3RvcmV9IGZyb20gXCIuLi8uLi9hcGkvaHlicmlkU3RvcmVcIjtcclxuaW1wb3J0IHtJbmRpY2F0ZXVyVmFsdWVTdG9yYWJsZX0gZnJvbSAnLi4vLi4vc3RvcmFibGVzL0luZGljYXRldXJWYWx1ZVN0b3JhYmxlJ1xyXG5pbXBvcnQge2dldEN1cnJlbnRFcGNpSWR9IGZyb20gXCIuLi8uLi9hcGkvY3VycmVudEVwY2lcIjtcclxuXHJcbi8qKlxyXG4gKiBQcmV2ZW50IGRlZmF1bHQgZm9ybSBiZWhhdmlvci5cclxuICovXHJcbmNvbnN0IHByZXZlbnREZWZhdWx0ID0gKGV2ZW50OiBFdmVudCk6IHZvaWQgPT4ge1xyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxyXG59XHJcblxyXG4vKipcclxuICogU2F2ZSB2YWx1ZSBmb3IgYSBzaW5nbGUgeWVhcmx5IGlucHV0IG9uIGJsdXIuXHJcbiAqL1xyXG5jb25zdCBvbkJsdXIgPSAoZXZlbnQ6IEZvY3VzRXZlbnQpOiB2b2lkID0+IHtcclxuICAgIGNvbnN0IGlucHV0ID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQ7XHJcbiAgICBjb25zdCB7aWQsIHllYXJ9ID0gaW5wdXRQcm9wZXJ0aWVzKGlucHV0KVxyXG4gICAgY29uc3QgY3VycmVudEVwY2lJZCA9IGdldEN1cnJlbnRFcGNpSWQoKVxyXG4gICAgY29uc3QgdmFsdWUgPSBuZXcgSW5kaWNhdGV1clZhbHVlU3RvcmFibGUoe1xyXG4gICAgICAgIGVwY2lfaWQ6IGN1cnJlbnRFcGNpSWQsXHJcbiAgICAgICAgaW5kaWNhdGV1cl9pZDogaWQsXHJcbiAgICAgICAgeWVhcjogeWVhcixcclxuICAgICAgICB2YWx1ZTogaW5wdXQudmFsdWVcclxuICAgIH0pXHJcblxyXG4gICAgaW5kaWNhdGV1clZhbHVlU3RvcmUuc3RvcmUodmFsdWUpXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDYWxsIGJsdXIgb24gZW50ZXIuXHJcbiAqL1xyXG5jb25zdCBvbktleVByZXNzID0gKGV2ZW50OiBLZXlib2FyZEV2ZW50KTogdm9pZCA9PiB7XHJcbiAgICBpZiAoZXZlbnQua2V5ID09PSAnRW50ZXInKSB7XHJcbiAgICAgICAgY29uc3QgaW5wdXQgPSBldmVudC50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudFxyXG4gICAgICAgIGlucHV0LmJsdXIoKVxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBhIHNpbmdsZSB5ZWFybHkgaW5wdXQgd2l0aCBhIHJldHJpZXZlZCB2YWx1ZSBvciBhbiBlbXB0eSB2YWx1ZSBpZiBub25lIGZvdW5kLlxyXG4gKi9cclxuY29uc3QgaW5pdFllYXJseUlucHV0ID0gYXN5bmMgKGlucHV0OiBIVE1MSW5wdXRFbGVtZW50KTogUHJvbWlzZTx2b2lkPiA9PiB7XHJcblxyXG4gICAgaW5wdXQudmFsdWUgPSAgJydcclxuICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBvbkJsdXIpXHJcbiAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXlwcmVzcycsIG9uS2V5UHJlc3MpXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBFeHRyYWN0IGluZGljYXRldXIgaWQgYW5kIHllYXIgZnJvbSBpbnB1dC5cclxuICovXHJcbmNvbnN0IGlucHV0UHJvcGVydGllcyA9IChpbnB1dDogSFRNTElucHV0RWxlbWVudCk6IHsgaWQ6IHN0cmluZywgeWVhcjogbnVtYmVyIH0gPT4ge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpZDogaW5wdXQuZGF0YXNldC5pbmRpY2F0b3JJZCEsXHJcbiAgICAgICAgeWVhcjogK2lucHV0LmRhdGFzZXQuaW5kaWNhdG9yWWVhciEsXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIGVhY2ggeWVhcmx5IGlucHV0IGxpbmtlZCB0byBhbiBpbmRpY2F0b3Igd2l0aCBhbGwgaXRzIGV2ZW50IGxpc3RlbmVycy5cclxuICovXHJcbmV4cG9ydCBjb25zdCBpbml0ID0gYXN5bmMgIChmb3JtOiBIVE1MRm9ybUVsZW1lbnQpOiBQcm9taXNlPHZvaWQ+ID0+IHtcclxuICAgIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgcHJldmVudERlZmF1bHQpXHJcbiAgICBjb25zdCBpbnB1dHMgPSBmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0JylcclxuICAgIGZvciAobGV0IGlucHV0IG9mIGlucHV0cykge1xyXG4gICAgICAgIGluaXRZZWFybHlJbnB1dChpbnB1dClcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB7aWQsIHllYXJ9ID0gaW5wdXRQcm9wZXJ0aWVzKGlucHV0c1swXSlcclxuICAgIGNvbnN0IGVwY2lJZCA9IGdldEN1cnJlbnRFcGNpSWQoKVxyXG5cclxuICAgIGNvbnN0IGluZGljYXRldXJWYWx1ZXMgPSBhd2FpdCBpbmRpY2F0ZXVyVmFsdWVTdG9yZS5yZXRyaWV2ZUF0UGF0aChcclxuICAgICAgICBgJHtlcGNpSWR9LyR7aWR9YFxyXG4gICAgKVxyXG5cclxuICAgIGZvciAobGV0IGlucHV0IG9mIGlucHV0cykge1xyXG4gICAgICAgIGNvbnN0IHtpZCwgeWVhcn0gPSBpbnB1dFByb3BlcnRpZXMoaW5wdXQpXHJcbiAgICAgICAgbGV0IHZhbHVlID0gJydcclxuICAgICAgICBmb3IgKGxldCBpbmRpY2F0ZXVyVmFsdWUgb2YgaW5kaWNhdGV1clZhbHVlcykge1xyXG4gICAgICAgICAgICBpZiAoaW5kaWNhdGV1clZhbHVlLnllYXIgPT0geWVhciAmJiBpbmRpY2F0ZXVyVmFsdWUuaW5kaWNhdGV1cl9pZCA9PSBpZClcclxuICAgICAgICAgICAgICAgIHZhbHVlID0gaW5kaWNhdGV1clZhbHVlLnZhbHVlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnB1dC52YWx1ZSA9IHZhbHVlXHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG4iLCJpbXBvcnQgeyBpbml0IH0gZnJvbSAnLi9pbmRpY2F0b3JGb3JtJ1xyXG5cclxuY29uc3QgZm9ybXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxGb3JtRWxlbWVudD4oJ1tkYXRhLWNvbXBvbmVudD1cImluZGljYXRvckZvcm1cIl0nKVxyXG5cclxuZm9ybXMuZm9yRWFjaCgoZm9ybSk6IHZvaWQgPT4ge1xyXG4gICAgaW5pdChmb3JtKTtcclxufSlcclxuIl0sInNvdXJjZVJvb3QiOiIifQ==