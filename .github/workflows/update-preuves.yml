name: Update preuves

on:
  push:
    # paths:
    #   - "markdown/preuves/*.md"
  pull_request:
    branches-ignore:
      - production
      - production-static

jobs:
  parse-preuves:
    name: Lecture et conversion des fichiers markdown
    runs-on: ubuntu-latest

    steps:
      # cf. https://github.com/actions/checkout
      - uses: actions/checkout@v2

      # Execute CLI on local datalayer if branch not in [upcoming-sandbox, upcoming-production]
      - name: Execute parsing scripts to generate JSON files in data_layer/content
        run: docker compose run --no-deps business-parse-preuves

      # TODO : check that data_layer can
      # Copy all projet .sample.env into .env with the variables
      - name: Make .env files
        run: sh make_dot_env.sh

      # Run content update container.
      - name: Load content in datalayer
        run: docker-compose run loader_2

      # Commit changes
      - name: Commit generated JSON files
        uses: EndBug/add-and-commit@v7
        with:
          default_author: github_actions
          message: Generated preuves from updated markdowns.
